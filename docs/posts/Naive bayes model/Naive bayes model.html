<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Creo Hsia">
<meta name="dcterms.date" content="2024-10-14">
<meta name="description" content="A self use function for Naive Bayes classifier">

<title>Naive Bayes Model – Creo Hsia</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Creo Hsia</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Blogs</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/CreoHAHAHA"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/CreoHsia"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:creoxjz@gmail.com"> <i class="bi bi-envelope" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Naive Bayes Model</h1>
                  <div>
        <div class="description">
          A self use function for Naive Bayes classifier
        </div>
      </div>
                </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Creo Hsia </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">October 14, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#function-bayesclasifier" id="toc-function-bayesclasifier" class="nav-link active" data-scroll-target="#function-bayesclasifier"><span class="header-section-number">1</span> Function <code>Bayesclasifier</code></a></li>
  <li><a href="#function-predict.naivebayes_clasifier" id="toc-function-predict.naivebayes_clasifier" class="nav-link" data-scroll-target="#function-predict.naivebayes_clasifier"><span class="header-section-number">2</span> Function <code>predict.naiveBayes_clasifier</code></a></li>
  <li><a href="#function-confusion_matrix-and-roc_auc" id="toc-function-confusion_matrix-and-roc_auc" class="nav-link" data-scroll-target="#function-confusion_matrix-and-roc_auc"><span class="header-section-number">3</span> Function <code>confusion_matrix</code> and <code>roc_auc</code></a></li>
  <li><a href="#function-plot.roc_auc" id="toc-function-plot.roc_auc" class="nav-link" data-scroll-target="#function-plot.roc_auc"><span class="header-section-number">4</span> Function <code>plot.roc_auc</code></a></li>
  <li><a href="#a-real-example" id="toc-a-real-example" class="nav-link" data-scroll-target="#a-real-example"><span class="header-section-number">5</span> A real example</a></li>
  <li><a href="#function-print.naivebayes_clasifier" id="toc-function-print.naivebayes_clasifier" class="nav-link" data-scroll-target="#function-print.naivebayes_clasifier"><span class="header-section-number">6</span> Function <code>print.naiveBayes_clasifier</code></a></li>
  <li><a href="#supervisor-provided-r-code-for-naive-bayes-classifier" id="toc-supervisor-provided-r-code-for-naive-bayes-classifier" class="nav-link" data-scroll-target="#supervisor-provided-r-code-for-naive-bayes-classifier"><span class="header-section-number">7</span> Supervisor-provided R code for Naive Bayes Classifier</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<hr>
<p>We build a Naive Bayes classifier that can handle any classification problem, assuming continuous variables follow a normal distribution. This classifier is not limited to the specific problem in the exercises.</p>
<section id="function-bayesclasifier" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="function-bayesclasifier"><span class="header-section-number">1</span> Function <code>Bayesclasifier</code></h2>
<p>The following function fits a Naive Bayes model to the data, estimating prior probabilities and conditional probabilities for both continuous and categorical features. This function takes four inputs: the <code>data</code>, the <code>response</code> (a <code>character string</code> specifying which column contains the class labels), the <code>prior</code> (if provided), and the <code>Laplace smoothing parameter</code>. The output is a list containing the conditional probabilities for each variable, the prior probabilities, an indicator of which columns are numeric or categorical, and the levels of the class labels. The returned list is of class <code>naiveBayes</code>, which allows for method dispatching specific to this model.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>Bayesclasifier <span class="ot">&lt;-</span> <span class="cf">function</span>(data, response, <span class="at">prior =</span> <span class="cn">NULL</span>, <span class="at">alpha =</span> <span class="dv">0</span>) {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Step 1: Extract the target variable (response)</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 'label' contains the target class from the 'response' column of the data</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  label <span class="ot">&lt;-</span> data[[response]]</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  label_counts <span class="ot">&lt;-</span> <span class="fu">table</span>(label)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  level <span class="ot">&lt;-</span> <span class="fu">unique</span>(label)<span class="co"># Identify unique classes in the target variable</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove the response column from the data </span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#(since it should not be used as a predictor)</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  data[[response]] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Step 2: Calculate prior probabilities if not provided</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(prior)) {</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    prior <span class="ot">&lt;-</span> <span class="fu">prop.table</span>(label_counts)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Step 3: Identify numeric and categorical columns</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  is_num <span class="ot">&lt;-</span> <span class="fu">sapply</span>(data, <span class="cf">function</span>(x) <span class="fu">is.numeric</span>(x))</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Step 4: Process numeric and categorical columns separately</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  tbl <span class="ot">&lt;-</span> <span class="fu">lapply</span>(data,<span class="cf">function</span>(col){</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.numeric</span>(col)){</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>      <span class="co"># For numeric columns, calculate the mean and variance</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>      <span class="co">#for each class in the target variable</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>      means <span class="ot">&lt;-</span> <span class="fu">tapply</span>(col, label, mean,<span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>      sd <span class="ot">&lt;-</span> <span class="fu">tapply</span>(col, label, sd,<span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cbind</span>(means,sd)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>      <span class="co"># For categorical columns, calculate smoothed counts </span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>      <span class="co"># and conditional probabilities</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Do not display the count of NA values (this is the default behavior)</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>      counts <span class="ot">&lt;-</span> <span class="fu">table</span>(label, col)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Apply Laplace smoothing to avoid zero probabilities</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>      smoothed_probs <span class="ot">&lt;-</span> <span class="fu">sweep</span>(counts <span class="sc">+</span> alpha, <span class="dv">1</span>,</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>                              label_counts<span class="sc">+</span>alpha<span class="sc">*</span><span class="fu">ncol</span>(counts), <span class="st">"/"</span>)</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Calculate conditional probabilities</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(smoothed_probs)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return the model as a list containing: </span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>  <span class="co">#1) prior probabilities, 2) tables of statistics, 3) and metadata</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior =</span> prior, <span class="at">tables =</span> tbl, </span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">isnumeric=</span>is_num,</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">level=</span>level)</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Assign a class to the result for method dispatch</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(result) <span class="ot">&lt;-</span> <span class="st">"naiveBayes_clasifier"</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>} </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="function-predict.naivebayes_clasifier" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="function-predict.naivebayes_clasifier"><span class="header-section-number">2</span> Function <code>predict.naiveBayes_clasifier</code></h2>
<p>The predict function takes a trained Naive Bayes model and new data as inputs, and returns predicted class labels or class probabilities depending on the specified type. For missing values (<code>NA</code>), the function handles them by assigning neutral probabilities (effectively ignoring them in the likelihood calculation).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>predict.naiveBayes_clasifier <span class="ot">&lt;-</span> <span class="cf">function</span>(model, newdata, <span class="at">type =</span> <span class="st">"class"</span>) {</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  logprior <span class="ot">&lt;-</span> <span class="fu">log</span>(model<span class="sc">$</span>prior)   </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  len <span class="ot">&lt;-</span> <span class="fu">length</span>(model<span class="sc">$</span>prior)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Match newdata columns with model attributes</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  match_idx <span class="ot">&lt;-</span> <span class="fu">match</span>(<span class="fu">names</span>(model<span class="sc">$</span>tables), <span class="fu">names</span>(newdata))  </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Step 3: Preallocate log probability matrix for faster computation</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  Logprob <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> len, <span class="at">ncol =</span> <span class="fu">nrow</span>(newdata),<span class="at">dimnames =</span> <span class="fu">list</span>(model<span class="sc">$</span>level,<span class="cn">NULL</span>))</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Step 1: Convert categorical variables to factors with matching levels</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (v <span class="cf">in</span> <span class="fu">seq_along</span>(match_idx)) {</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (model<span class="sc">$</span>isnumeric[v]){</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>      nd <span class="ot">&lt;-</span> newdata[, match_idx[v]]</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>      tbl <span class="ot">&lt;-</span> model<span class="sc">$</span>tables[[v]]</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>      means <span class="ot">&lt;-</span> tbl[, <span class="dv">1</span>]</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>      sd <span class="ot">&lt;-</span> tbl[, <span class="dv">2</span>]</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>      notna <span class="ot">&lt;-</span> <span class="sc">!</span><span class="fu">is.na</span>(nd)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>      Logprob[,notna] <span class="ot">&lt;-</span>Logprob[,notna]<span class="sc">+</span> <span class="fu">vapply</span>(nd[notna],<span class="cf">function</span>(x) <span class="fu">dnorm</span>(x,means,sd,<span class="at">log=</span><span class="cn">TRUE</span>),<span class="fu">numeric</span>(len))</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>      nd <span class="ot">&lt;-</span> <span class="fu">factor</span>(newdata[,match_idx[v]],</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>                             <span class="at">levels =</span> <span class="fu">colnames</span>(model<span class="sc">$</span>tables[[v]]))</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>      notna <span class="ot">&lt;-</span> <span class="sc">!</span><span class="fu">is.na</span>(nd)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>      Logprob[,notna] <span class="ot">&lt;-</span>Logprob[,notna]<span class="sc">+</span> <span class="fu">log</span>(model<span class="sc">$</span>tables[[v]][,nd[notna]])</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Step 5: Add log-priors to the computed log-likelihoods</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  Logprob <span class="ot">&lt;-</span> <span class="fu">sweep</span>(Logprob, <span class="dv">1</span>, logprior, <span class="st">"+"</span>)</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Step 6: Return predictions based on the specified type ('class' or 'raw')</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (type <span class="sc">==</span> <span class="st">"class"</span>) {</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    pred_classes <span class="ot">&lt;-</span> model<span class="sc">$</span>level[<span class="fu">apply</span>(Logprob,<span class="dv">2</span>,which.max)]</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(pred_classes)</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If type == "raw", return probabilities for all classes</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    probs <span class="ot">&lt;-</span> <span class="fu">exp</span>(Logprob)  <span class="co"># Convert log-probabilities back to normal scale</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Normalize probabilities so they sum to 1</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>    probs <span class="ot">&lt;-</span> <span class="fu">apply</span>(probs,<span class="dv">2</span>,<span class="cf">function</span>(x)x<span class="sc">/</span><span class="fu">sum</span>(x) ) </span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">t</span>(probs))</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="function-confusion_matrix-and-roc_auc" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="function-confusion_matrix-and-roc_auc"><span class="header-section-number">3</span> Function <code>confusion_matrix</code> and <code>roc_auc</code></h2>
<p>The first function computes the confusion matrix, which compares the true class labels with the predicted class labels to evaluate the performance of the classification model.</p>
<blockquote class="blockquote">
<ul>
<li><p>Input:</p>
<ul>
<li><p><code>true_labels</code>: A vector of true class labels for the dataset.</p></li>
<li><p><code>predicted_class</code>: A vector of predicted class labels for the dataset. This is typically the output after selecting the class with the highest predicted probability for each instance.</p></li>
</ul></li>
<li><p>Output:</p>
<ul>
<li>A confusion matrix, where rows represent the actual class labels and columns represent the predicted class labels.&nbsp;</li>
</ul></li>
</ul>
</blockquote>
<p>The second function computes the ROC curve and Area Under the Curve (AUC) for each class in the classification problem.</p>
<blockquote class="blockquote">
<ul>
<li><p>Input: the same as above</p></li>
<li><p>Output:</p>
<p>A list containing:</p>
<ul>
<li><p><code>roc_data</code>: A data frame with columns FPR (False Positive Rate), TPR (True Positive Rate), and class for each class, representing the ROC curve points for each class.</p></li>
<li><p><code>auc</code>: A named vector where each entry is the AUC value for one class, with the class names as the vector names.</p></li>
</ul></li>
</ul>
</blockquote>
<p>While these functions can handle binary classification, they are especially suited for multi-class classification problems. In multi-class classification, the “one-vs-all” (or “one-vs-rest”) approach is applied. This means that for each class, the function treats it as the positive class and considers all other classes as the negative class.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to create a confusion matrix based on true labels and predicted class labels</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>confusion_matrix <span class="ot">&lt;-</span> <span class="cf">function</span>(true_labels, predicted_class) {</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  class_names <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(true_labels, predicted_class))</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create an empty confusion matrix</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  conf_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">length</span>(class_names), <span class="at">ncol =</span> <span class="fu">length</span>(class_names),</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="st">"Actual"</span> <span class="ot">=</span> class_names, <span class="st">"Predicted"</span> <span class="ot">=</span> class_names))</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Populate the confusion matrix</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(true_labels)) {</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    true_class <span class="ot">&lt;-</span> true_labels[i]</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    pred_class <span class="ot">&lt;-</span> predicted_class[i]</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    conf_matrix[true_class, pred_class] <span class="ot">&lt;-</span> conf_matrix[true_class, pred_class] <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(conf_matrix)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>roc_auc <span class="ot">&lt;-</span> <span class="cf">function</span>(true_labels, predicted_probs) {</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get unique class names</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  classes <span class="ot">&lt;-</span> <span class="fu">colnames</span>(predicted_probs)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Internal function to compute sensitivity and specificity with vectorized operations</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  compute_roc_auc <span class="ot">&lt;-</span> <span class="cf">function</span>(binary_labels, pos_prob) {</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort the predicted probabilities and corresponding labels once</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    order_index <span class="ot">&lt;-</span> <span class="fu">order</span>(pos_prob, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    sorted_labels <span class="ot">&lt;-</span> binary_labels[order_index]</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Number of positive and negative samples</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    M <span class="ot">&lt;-</span> <span class="fu">sum</span>(sorted_labels <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    N <span class="ot">&lt;-</span> <span class="fu">sum</span>(sorted_labels <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Cumulative sum to calculate sensitivity (sen) and specificity (spe)</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    sen <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(sorted_labels <span class="sc">==</span> <span class="dv">1</span>)  <span class="co"># True positives as we go down the list</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    spe <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(sorted_labels <span class="sc">==</span> <span class="dv">0</span>)  <span class="co"># False positives as we go down the list</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sensitivity and specificity as ratios</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    TPR <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, sen <span class="sc">/</span> M)</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>    FPR <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, spe <span class="sc">/</span> N)</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate AUC using the trapezoidal rule (efficiently using vectorized operations)</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    auc <span class="ot">&lt;-</span> <span class="fu">sum</span>((FPR[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">-</span> FPR[<span class="sc">-</span><span class="fu">length</span>(FPR)]) <span class="sc">*</span> (TPR[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">+</span> TPR[<span class="sc">-</span><span class="fu">length</span>(TPR)])) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return results as a matrix for better performance</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">roc =</span> <span class="fu">data.frame</span>(<span class="at">FPR =</span> FPR, <span class="at">TPR =</span> TPR), <span class="at">auc =</span> auc))</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if it's a binary classification problem</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(classes) <span class="sc">==</span> <span class="dv">2</span>) {</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>    class_name <span class="ot">&lt;-</span> classes[<span class="dv">1</span>]</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>    binary_labels <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(true_labels <span class="sc">==</span> class_name, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>    pos_prob <span class="ot">&lt;-</span> predicted_probs[, class_name]</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute ROC for the binary classification</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>    roc_auc_result <span class="ot">&lt;-</span> <span class="fu">compute_roc_auc</span>(binary_labels, pos_prob)</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>    roc_data <span class="ot">&lt;-</span> roc_auc_result<span class="sc">$</span>roc</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>    roc_data<span class="sc">$</span>class <span class="ot">&lt;-</span> class_name  <span class="co"># Add class column</span></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>    auc <span class="ot">&lt;-</span> <span class="fu">setNames</span>(roc_auc_result<span class="sc">$</span>auc, class_name)  <span class="co"># Return AUC as named vector</span></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For multi-class classification, use one-vs-all approach</span></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>    roc_data_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>    auc <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">length</span>(classes)), classes)  <span class="co"># Initialize a named vector for AUC</span></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop through each class and calculate sensitivity and specificity</span></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (class_name <span class="cf">in</span> classes) {</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>      binary_labels <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(true_labels <span class="sc">==</span> class_name, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>      pos_prob <span class="ot">&lt;-</span> predicted_probs[, class_name]</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Compute ROC for the current class</span></span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>      class_roc_auc_result <span class="ot">&lt;-</span> <span class="fu">compute_roc_auc</span>(binary_labels, pos_prob)</span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>      class_roc_data <span class="ot">&lt;-</span> class_roc_auc_result<span class="sc">$</span>roc</span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>      class_roc_data<span class="sc">$</span>class <span class="ot">&lt;-</span> class_name  <span class="co"># Add class column</span></span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Store ROC data and AUC for the current class</span></span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>      roc_data_list[[class_name]] <span class="ot">&lt;-</span> class_roc_data</span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>      auc[class_name] <span class="ot">&lt;-</span> class_roc_auc_result<span class="sc">$</span>auc  <span class="co"># Assign AUC to the named vector</span></span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Combine ROC results for all classes into a single data frame</span></span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>    roc_data <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, roc_data_list)</span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">roc_data =</span> roc_data, <span class="at">auc =</span> auc)</span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(result) <span class="ot">&lt;-</span> <span class="st">"roc_auc"</span></span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="function-plot.roc_auc" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="function-plot.roc_auc"><span class="header-section-number">4</span> Function <code>plot.roc_auc</code></h2>
<p>A <code>ggplot2</code> plot displaying the ROC curves for all classes. Each class is represented by a different color, and the AUC values are shown on the plot to summarize the classifier’s performance for each class.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>plot.roc_auc <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ...) {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract ROC data and AUC values</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  roc_data <span class="ot">&lt;-</span> x<span class="sc">$</span>roc_data</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  auc_values <span class="ot">&lt;-</span> x<span class="sc">$</span>auc</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a data frame for AUC values to annotate</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  auc_annotations <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">class =</span> <span class="fu">names</span>(auc_values),</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">auc =</span> <span class="fu">round</span>(auc_values, <span class="dv">4</span>),</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">paste</span>(<span class="fu">names</span>(auc_values), <span class="st">": "</span>, <span class="fu">round</span>(auc_values, <span class="dv">4</span>), <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Plot all ROC curves, using different colors for each class</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(roc_data, <span class="fu">aes</span>(<span class="at">x =</span> FPR, <span class="at">y =</span> TPR, <span class="at">color =</span> class)) <span class="sc">+</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"ROC Curves for All Classes"</span>,</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"False Positive Rate"</span>, <span class="at">y =</span> <span class="st">"True Positive Rate"</span>) <span class="sc">+</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Annotate AUC values at the top-right corner without any box or frame</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  auc_text <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"AUC:</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">paste</span>(auc_annotations<span class="sc">$</span>label, <span class="at">collapse =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">0.8</span>, <span class="at">y =</span> <span class="fl">0.6</span>, <span class="at">hjust =</span> <span class="dv">0</span>,</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>                    <span class="at">label =</span> auc_text, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"black"</span>)</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Display the plot</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(p)</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="a-real-example" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="a-real-example"><span class="header-section-number">5</span> A real example</h2>
<p>we apply the custom Naive Bayes classifier that we implemented to the Adult dataset (The data can be found in <a href="https://github.com/CreoHsia/myblog/tree/main/posts/Naive%20bayes%20model">Github</a>) for classification. We also compare its performance in terms of speed with the naiveBayes function from the e1071 R package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"adult.data"</span>,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">na.strings =</span> <span class="st">" ?"</span>, <span class="at">header=</span><span class="cn">FALSE</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>newdata <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">"adult.test"</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">sep=</span><span class="st">","</span>, <span class="at">skip =</span> <span class="dv">1</span>,<span class="at">na.strings =</span> <span class="st">" ?"</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>newdata<span class="sc">$</span>V15 <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">.$"</span>, <span class="st">""</span>, newdata<span class="sc">$</span>V15)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>({</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">Bayesclasifier</span>(data,<span class="st">"V15"</span>,<span class="at">alpha =</span> <span class="dv">1</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(model,newdata,<span class="st">"raw"</span>)  </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  roc <span class="ot">&lt;-</span> <span class="fu">roc_auc</span>(newdata<span class="sc">$</span>V15,pred)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>   user  system elapsed </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fl">0.160</span>   <span class="fl">0.005</span>   <span class="fl">0.165</span> </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(e1071)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>({</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  model2 <span class="ot">&lt;-</span> e1071<span class="sc">::</span><span class="fu">naiveBayes</span>(V15<span class="sc">~</span>.,<span class="at">data=</span>data)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  pred2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(model2,newdata)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>   user  system elapsed </span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  <span class="fl">1.327</span>   <span class="fl">0.008</span>   <span class="fl">1.338</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Faster than the function in <code>e1071</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confusion_matrix</span>(newdata<span class="sc">$</span>V15,pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(model,newdata,<span class="st">"class"</span>))</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>        Predicted</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>Actual    <span class="sc">&lt;=</span><span class="dv">50</span>K  <span class="sc">&gt;</span><span class="dv">50</span>K</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>   <span class="sc">&lt;=</span><span class="dv">50</span>K  <span class="dv">11547</span>   <span class="dv">888</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>   <span class="sc">&gt;</span><span class="dv">50</span>K    <span class="dv">1863</span>  <span class="dv">1983</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Naive-bayes-model_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="function-print.naivebayes_clasifier" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="function-print.naivebayes_clasifier"><span class="header-section-number">6</span> Function <code>print.naiveBayes_clasifier</code></h2>
<p>This function prints a summary of the fitted model, including the prior probabilities, the conditional probabilities for each variable, and an indication of whether each variable is numeric or categorical.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>print.naiveBayes_clasifier <span class="ot">&lt;-</span> <span class="cf">function</span>(model) {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Naive Bayes Model</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"=================</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Print class levels</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Class Levels:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(model<span class="sc">$</span>level)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Print prior probabilities</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Prior Probabilities:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(model<span class="sc">$</span>prior)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Loop through the model tables to display statistics for each feature</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Feature Statistics:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(model<span class="sc">$</span>tables)) {</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    feature_name <span class="ot">&lt;-</span> <span class="fu">names</span>(model<span class="sc">$</span>tables)[i]</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Feature:"</span>, feature_name, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (model<span class="sc">$</span>isnumeric[i]) {</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>      <span class="co"># For numeric features, print mean and standard deviation</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Type: Numeric</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>      stats <span class="ot">&lt;-</span> model<span class="sc">$</span>tables[[i]]</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(<span class="fu">data.frame</span>(</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">Mean =</span> stats[, <span class="dv">1</span>], <span class="at">SD =</span> stats[, <span class="dv">2</span>]))</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>      <span class="co"># For categorical features, print conditional probabilities</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Type: Categorical</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>      probs <span class="ot">&lt;-</span> model<span class="sc">$</span>tables[[i]]</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(<span class="fu">as.data.frame.matrix</span>(probs))</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=================</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(model)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>Naive Bayes Model</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="sc">==</span><span class="er">===============</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>Class Levels<span class="sc">:</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">" &lt;=50K"</span> <span class="st">" &gt;50K"</span> </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>Prior Probabilities<span class="sc">:</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>label</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="sc">&lt;=</span><span class="dv">50</span>K      <span class="sc">&gt;</span><span class="dv">50</span>K </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="fl">0.7591904</span> <span class="fl">0.2408096</span> </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>Feature Statistics<span class="sc">:</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>Feature<span class="sc">:</span> V1 </span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>Type<span class="sc">:</span> Numeric</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>           Mean       SD</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a> <span class="sc">&lt;=</span><span class="dv">50</span>K <span class="fl">36.78374</span> <span class="fl">14.02009</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a> <span class="sc">&gt;</span><span class="dv">50</span>K  <span class="fl">44.24984</span> <span class="fl">10.51903</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>Feature<span class="sc">:</span> V2 </span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>Type<span class="sc">:</span> Categorical</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>        Federal<span class="sc">-</span>gov  Local<span class="sc">-</span>gov  Never<span class="sc">-</span>worked   Private  Self<span class="sc">-</span>emp<span class="sc">-</span>inc</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a> <span class="sc">&lt;=</span><span class="dv">50</span>K   <span class="fl">0.02385959</span> <span class="fl">0.05972986</span>  <span class="fl">0.0003235199</span> <span class="fl">0.7171627</span>    <span class="fl">0.02001779</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a> <span class="sc">&gt;</span><span class="dv">50</span>K    <span class="fl">0.04739457</span> <span class="fl">0.07873614</span>  <span class="fl">0.0001274048</span> <span class="fl">0.6324373</span>    <span class="fl">0.07937317</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>        Self<span class="sc">-</span>emp<span class="sc">-</span>not<span class="sc">-</span>inc  State<span class="sc">-</span>gov  Without<span class="sc">-</span>pay</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a> <span class="sc">&lt;=</span><span class="dv">50</span>K        <span class="fl">0.07351990</span> <span class="fl">0.03825623</span> <span class="fl">0.0006065998</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a> <span class="sc">&gt;</span><span class="dv">50</span>K         <span class="fl">0.09236845</span> <span class="fl">0.04510129</span> <span class="fl">0.0001274048</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>Feature<span class="sc">:</span> V3 </span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>Type<span class="sc">:</span> Numeric</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>           Mean       SD</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a> <span class="sc">&lt;=</span><span class="dv">50</span>K <span class="fl">190340.9</span> <span class="fl">106482.3</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a> <span class="sc">&gt;</span><span class="dv">50</span>K  <span class="fl">188005.0</span> <span class="fl">102541.8</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>Feature<span class="sc">:</span> V4 </span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>Type<span class="sc">:</span> Categorical</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>              <span class="dv">10</span>th        <span class="dv">11</span>th        <span class="dv">12</span>th      <span class="dv">1</span>st<span class="dv">-4</span>th     <span class="dv">5</span>th<span class="dv">-6</span>th     <span class="dv">7</span>th<span class="dv">-8</span>th</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a> <span class="sc">&lt;=</span><span class="dv">50</span>K <span class="fl">0.035252264</span> <span class="fl">0.045116429</span> <span class="fl">0.016211190</span> <span class="fl">0.0065895860</span> <span class="fl">0.012855757</span> <span class="fl">0.024539133</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a> <span class="sc">&gt;</span><span class="dv">50</span>K  <span class="fl">0.008018328</span> <span class="fl">0.007763778</span> <span class="fl">0.004327351</span> <span class="fl">0.0008909253</span> <span class="fl">0.002163676</span> <span class="fl">0.005218277</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>               <span class="dv">9</span>th  Assoc<span class="sc">-</span>acdm  Assoc<span class="sc">-</span>voc  Bachelors   Doctorate   HS<span class="sc">-</span>grad</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a> <span class="sc">&lt;=</span><span class="dv">50</span>K <span class="fl">0.019728331</span>  <span class="fl">0.03246281</span> <span class="fl">0.04131630</span>  <span class="fl">0.1267384</span> <span class="fl">0.004366106</span> <span class="fl">0.3568483</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a> <span class="sc">&gt;</span><span class="dv">50</span>K  <span class="fl">0.003563701</span>  <span class="fl">0.03385516</span> <span class="fl">0.04607356</span>  <span class="fl">0.2828051</span> <span class="fl">0.039073438</span> <span class="fl">0.2133130</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>          Masters   Preschool  Prof<span class="sc">-</span>school  Some<span class="sc">-</span>college</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a> <span class="sc">&lt;=</span><span class="dv">50</span>K <span class="fl">0.03092658</span> <span class="fl">0.002102199</span>  <span class="fl">0.006225744</span>     <span class="fl">0.2387209</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a> <span class="sc">&gt;</span><span class="dv">50</span>K  <span class="fl">0.12218404</span> <span class="fl">0.000127275</span>  <span class="fl">0.053964618</span>     <span class="fl">0.1766578</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>Feature<span class="sc">:</span> V5 </span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>Type<span class="sc">:</span> Numeric</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>            Mean       SD</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a> <span class="sc">&lt;=</span><span class="dv">50</span>K  <span class="fl">9.595065</span> <span class="fl">2.436147</span></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a> <span class="sc">&gt;</span><span class="dv">50</span>K  <span class="fl">11.611657</span> <span class="fl">2.385129</span></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>Feature<span class="sc">:</span> V6 </span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>Type<span class="sc">:</span> Categorical</span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>         Divorced  Married<span class="sc">-</span>AF<span class="sc">-</span>spouse  Married<span class="sc">-</span>civ<span class="sc">-</span>spouse  Married<span class="sc">-</span>spouse<span class="sc">-</span>absent</span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a> <span class="sc">&lt;=</span><span class="dv">50</span>K <span class="fl">0.16099810</span>       <span class="fl">0.0005661827</span>           <span class="fl">0.3350588</span>            <span class="fl">0.015570025</span></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a> <span class="sc">&gt;</span><span class="dv">50</span>K  <span class="fl">0.05912334</span>       <span class="fl">0.0014016310</span>           <span class="fl">0.8528287</span>            <span class="fl">0.004459735</span></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>        Never<span class="sc">-</span>married   Separated    Widowed</span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a> <span class="sc">&lt;=</span><span class="dv">50</span>K     <span class="fl">0.41222146</span> <span class="fl">0.038823958</span> <span class="fl">0.03676143</span></span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a> <span class="sc">&gt;</span><span class="dv">50</span>K      <span class="fl">0.06269113</span> <span class="fl">0.008537207</span> <span class="fl">0.01095821</span></span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>Feature<span class="sc">:</span> V7 </span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>Type<span class="sc">:</span> Categorical</span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>        Adm<span class="sc">-</span>clerical  Armed<span class="sc">-</span>Forces  Craft<span class="sc">-</span>repair  Exec<span class="sc">-</span>managerial</span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a> <span class="sc">&lt;=</span><span class="dv">50</span>K    <span class="fl">0.13196410</span>  <span class="fl">0.0003638716</span>     <span class="fl">0.1282041</span>       <span class="fl">0.08486294</span></span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a> <span class="sc">&gt;</span><span class="dv">50</span>K     <span class="fl">0.06467218</span>  <span class="fl">0.0002546149</span>     <span class="fl">0.1183959</span>       <span class="fl">0.25066836</span></span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>        Farming<span class="sc">-</span>fishing  Handlers<span class="sc">-</span>cleaners  Machine<span class="sc">-</span>op<span class="sc">-</span>inspct  Other<span class="sc">-</span>service</span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a> <span class="sc">&lt;=</span><span class="dv">50</span>K       <span class="fl">0.03557856</span>         <span class="fl">0.05195278</span>         <span class="fl">0.07087410</span>     <span class="fl">0.12771893</span></span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a> <span class="sc">&gt;</span><span class="dv">50</span>K        <span class="fl">0.01476766</span>         <span class="fl">0.01107575</span>         <span class="fl">0.03195417</span>     <span class="fl">0.01756843</span></span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>        Priv<span class="sc">-</span>house<span class="sc">-</span>serv  Prof<span class="sc">-</span>specialty  Protective<span class="sc">-</span>serv     Sales</span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a> <span class="sc">&lt;=</span><span class="dv">50</span>K     <span class="fl">0.0060240964</span>      <span class="fl">0.09226166</span>       <span class="fl">0.01774885</span> <span class="fl">0.1078677</span></span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a> <span class="sc">&gt;</span><span class="dv">50</span>K      <span class="fl">0.0002546149</span>      <span class="fl">0.23679185</span>       <span class="fl">0.02698918</span> <span class="fl">0.1252705</span></span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>        Tech<span class="sc">-</span>support  Transport<span class="sc">-</span>moving</span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a> <span class="sc">&lt;=</span><span class="dv">50</span>K    <span class="fl">0.02611789</span>        <span class="fl">0.05166977</span></span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a> <span class="sc">&gt;</span><span class="dv">50</span>K     <span class="fl">0.03615532</span>        <span class="fl">0.04086569</span></span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a>Feature<span class="sc">:</span> V8 </span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>Type<span class="sc">:</span> Categorical</span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>         Husband  Not<span class="sc">-</span><span class="cf">in</span><span class="sc">-</span>family  Other<span class="sc">-</span>relative   Own<span class="sc">-</span>child  Unmarried</span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a> <span class="sc">&lt;=</span><span class="dv">50</span>K <span class="fl">0.2942651</span>      <span class="fl">0.3013023</span>     <span class="fl">0.038218879</span> <span class="fl">0.202297177</span> <span class="fl">0.13059128</span></span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a> <span class="sc">&gt;</span><span class="dv">50</span>K  <span class="fl">0.7543010</span>      <span class="fl">0.1092137</span>     <span class="fl">0.004842615</span> <span class="fl">0.008665732</span> <span class="fl">0.02790875</span></span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a>             Wife</span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a> <span class="sc">&lt;=</span><span class="dv">50</span>K <span class="fl">0.03332524</span></span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a> <span class="sc">&gt;</span><span class="dv">50</span>K  <span class="fl">0.09506818</span></span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a>Feature<span class="sc">:</span> V9 </span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a>Type<span class="sc">:</span> Categorical</span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a>        Amer<span class="sc">-</span>Indian<span class="sc">-</span>Eskimo  Asian<span class="sc">-</span>Pac<span class="sc">-</span>Islander      Black       Other     White</span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a> <span class="sc">&lt;=</span><span class="dv">50</span>K         <span class="fl">0.011162791</span>          <span class="fl">0.03089990</span> <span class="fl">0.11073812</span> <span class="fl">0.009989889</span> <span class="fl">0.8372093</span></span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a> <span class="sc">&gt;</span><span class="dv">50</span>K          <span class="fl">0.004715779</span>          <span class="fl">0.03530461</span> <span class="fl">0.04945195</span> <span class="fl">0.003313790</span> <span class="fl">0.9072139</span></span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a>Feature<span class="sc">:</span> V10 </span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a>Type<span class="sc">:</span> Categorical</span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a>          Female      Male</span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a> <span class="sc">&lt;=</span><span class="dv">50</span>K <span class="fl">0.3880349</span> <span class="fl">0.6119651</span></span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a> <span class="sc">&gt;</span><span class="dv">50</span>K  <span class="fl">0.1504526</span> <span class="fl">0.8495474</span></span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a>Feature<span class="sc">:</span> V11 </span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a>Type<span class="sc">:</span> Numeric</span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a>            Mean         SD</span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a> <span class="sc">&lt;=</span><span class="dv">50</span>K  <span class="fl">148.7525</span>   <span class="fl">963.1393</span></span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a> <span class="sc">&gt;</span><span class="dv">50</span>K  <span class="fl">4006.1425</span> <span class="fl">14570.3790</span></span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true" tabindex="-1"></a>Feature<span class="sc">:</span> V12 </span>
<span id="cb8-106"><a href="#cb8-106" aria-hidden="true" tabindex="-1"></a>Type<span class="sc">:</span> Numeric</span>
<span id="cb8-107"><a href="#cb8-107" aria-hidden="true" tabindex="-1"></a>            Mean       SD</span>
<span id="cb8-108"><a href="#cb8-108" aria-hidden="true" tabindex="-1"></a> <span class="sc">&lt;=</span><span class="dv">50</span>K  <span class="fl">53.14292</span> <span class="fl">310.7558</span></span>
<span id="cb8-109"><a href="#cb8-109" aria-hidden="true" tabindex="-1"></a> <span class="sc">&gt;</span><span class="dv">50</span>K  <span class="fl">195.00153</span> <span class="fl">595.4876</span></span>
<span id="cb8-110"><a href="#cb8-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-111"><a href="#cb8-111" aria-hidden="true" tabindex="-1"></a>Feature<span class="sc">:</span> V13 </span>
<span id="cb8-112"><a href="#cb8-112" aria-hidden="true" tabindex="-1"></a>Type<span class="sc">:</span> Numeric</span>
<span id="cb8-113"><a href="#cb8-113" aria-hidden="true" tabindex="-1"></a>           Mean       SD</span>
<span id="cb8-114"><a href="#cb8-114" aria-hidden="true" tabindex="-1"></a> <span class="sc">&lt;=</span><span class="dv">50</span>K <span class="fl">38.84021</span> <span class="fl">12.31899</span></span>
<span id="cb8-115"><a href="#cb8-115" aria-hidden="true" tabindex="-1"></a> <span class="sc">&gt;</span><span class="dv">50</span>K  <span class="fl">45.47303</span> <span class="fl">11.01297</span></span>
<span id="cb8-116"><a href="#cb8-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-117"><a href="#cb8-117" aria-hidden="true" tabindex="-1"></a>Feature<span class="sc">:</span> V14 </span>
<span id="cb8-118"><a href="#cb8-118" aria-hidden="true" tabindex="-1"></a>Type<span class="sc">:</span> Categorical</span>
<span id="cb8-119"><a href="#cb8-119" aria-hidden="true" tabindex="-1"></a>           Cambodia      Canada       China     Columbia        Cuba</span>
<span id="cb8-120"><a href="#cb8-120" aria-hidden="true" tabindex="-1"></a> <span class="sc">&lt;=</span><span class="dv">50</span>K <span class="fl">0.0005250192</span> <span class="fl">0.003352046</span> <span class="fl">0.002261621</span> <span class="fl">0.0023423933</span> <span class="fl">0.002867412</span></span>
<span id="cb8-121"><a href="#cb8-121" aria-hidden="true" tabindex="-1"></a> <span class="sc">&gt;</span><span class="dv">50</span>K  <span class="fl">0.0010149708</span> <span class="fl">0.005074854</span> <span class="fl">0.002664298</span> <span class="fl">0.0003806141</span> <span class="fl">0.003298655</span></span>
<span id="cb8-122"><a href="#cb8-122" aria-hidden="true" tabindex="-1"></a>        Dominican<span class="sc">-</span>Republic      Ecuador  El<span class="sc">-</span>Salvador     England       France</span>
<span id="cb8-123"><a href="#cb8-123" aria-hidden="true" tabindex="-1"></a> <span class="sc">&lt;=</span><span class="dv">50</span>K        <span class="fl">0.0027866403</span> <span class="fl">0.0010096523</span>  <span class="fl">0.003957837</span> <span class="fl">0.002463552</span> <span class="fl">0.0007269496</span></span>
<span id="cb8-124"><a href="#cb8-124" aria-hidden="true" tabindex="-1"></a> <span class="sc">&gt;</span><span class="dv">50</span>K         <span class="fl">0.0003806141</span> <span class="fl">0.0006343568</span>  <span class="fl">0.001268714</span> <span class="fl">0.003933012</span> <span class="fl">0.0016493276</span></span>
<span id="cb8-125"><a href="#cb8-125" aria-hidden="true" tabindex="-1"></a>           Germany      Greece    Guatemala        Haiti  Holand<span class="sc">-</span>Netherlands</span>
<span id="cb8-126"><a href="#cb8-126" aria-hidden="true" tabindex="-1"></a> <span class="sc">&lt;=</span><span class="dv">50</span>K <span class="fl">0.003796293</span> <span class="fl">0.000888494</span> <span class="fl">0.0025039376</span> <span class="fl">0.0016558297</span>        <span class="fl">8.077218e-05</span></span>
<span id="cb8-127"><a href="#cb8-127" aria-hidden="true" tabindex="-1"></a> <span class="sc">&gt;</span><span class="dv">50</span>K  <span class="fl">0.005709211</span> <span class="fl">0.001141842</span> <span class="fl">0.0005074854</span> <span class="fl">0.0006343568</span>        <span class="fl">1.268714e-04</span></span>
<span id="cb8-128"><a href="#cb8-128" aria-hidden="true" tabindex="-1"></a>           Honduras         Hong      Hungary       India        Iran</span>
<span id="cb8-129"><a href="#cb8-129" aria-hidden="true" tabindex="-1"></a> <span class="sc">&lt;=</span><span class="dv">50</span>K <span class="fl">0.0005250192</span> <span class="fl">0.0006057914</span> <span class="fl">0.0004442470</span> <span class="fl">0.002463552</span> <span class="fl">0.001050038</span></span>
<span id="cb8-130"><a href="#cb8-130" aria-hidden="true" tabindex="-1"></a> <span class="sc">&gt;</span><span class="dv">50</span>K  <span class="fl">0.0002537427</span> <span class="fl">0.0008880995</span> <span class="fl">0.0005074854</span> <span class="fl">0.005201725</span> <span class="fl">0.002410556</span></span>
<span id="cb8-131"><a href="#cb8-131" aria-hidden="true" tabindex="-1"></a>            Ireland       Italy     Jamaica       Japan         Laos</span>
<span id="cb8-132"><a href="#cb8-132" aria-hidden="true" tabindex="-1"></a> <span class="sc">&lt;=</span><span class="dv">50</span>K <span class="fl">0.0008077218</span> <span class="fl">0.001978918</span> <span class="fl">0.002907799</span> <span class="fl">0.001575058</span> <span class="fl">0.0006865635</span></span>
<span id="cb8-133"><a href="#cb8-133" aria-hidden="true" tabindex="-1"></a> <span class="sc">&gt;</span><span class="dv">50</span>K  <span class="fl">0.0007612281</span> <span class="fl">0.003298655</span> <span class="fl">0.001395585</span> <span class="fl">0.003171784</span> <span class="fl">0.0003806141</span></span>
<span id="cb8-134"><a href="#cb8-134" aria-hidden="true" tabindex="-1"></a>            Mexico    Nicaragua  Outlying<span class="sc">-</span><span class="fu">US</span>(Guam<span class="sc">-</span>USVI<span class="sc">-</span>etc)         Peru</span>
<span id="cb8-135"><a href="#cb8-135" aria-hidden="true" tabindex="-1"></a> <span class="sc">&lt;=</span><span class="dv">50</span>K <span class="fl">0.024675902</span> <span class="fl">0.0013327410</span>                <span class="fl">0.0006057914</span> <span class="fl">0.0012115827</span></span>
<span id="cb8-136"><a href="#cb8-136" aria-hidden="true" tabindex="-1"></a> <span class="sc">&gt;</span><span class="dv">50</span>K  <span class="fl">0.004313626</span> <span class="fl">0.0003806141</span>                <span class="fl">0.0001268714</span> <span class="fl">0.0003806141</span></span>
<span id="cb8-137"><a href="#cb8-137" aria-hidden="true" tabindex="-1"></a>        Philippines      Poland     Portugal  Puerto<span class="sc">-</span>Rico     Scotland</span>
<span id="cb8-138"><a href="#cb8-138" aria-hidden="true" tabindex="-1"></a> <span class="sc">&lt;=</span><span class="dv">50</span>K  <span class="fl">0.005573281</span> <span class="fl">0.001978918</span> <span class="fl">0.0013731271</span>  <span class="fl">0.004159767</span> <span class="fl">0.0004038609</span></span>
<span id="cb8-139"><a href="#cb8-139" aria-hidden="true" tabindex="-1"></a> <span class="sc">&gt;</span><span class="dv">50</span>K   <span class="fl">0.007866024</span> <span class="fl">0.001649328</span> <span class="fl">0.0006343568</span>  <span class="fl">0.001649328</span> <span class="fl">0.0005074854</span></span>
<span id="cb8-140"><a href="#cb8-140" aria-hidden="true" tabindex="-1"></a>             South      Taiwan     Thailand  Trinadad<span class="sc">&amp;</span>Tobago  United<span class="sc">-</span>States</span>
<span id="cb8-141"><a href="#cb8-141" aria-hidden="true" tabindex="-1"></a> <span class="sc">&lt;=</span><span class="dv">50</span>K <span class="fl">0.002625096</span> <span class="fl">0.001292355</span> <span class="fl">0.0006461775</span>     <span class="fl">0.0007269496</span>      <span class="fl">0.8884940</span></span>
<span id="cb8-142"><a href="#cb8-142" aria-hidden="true" tabindex="-1"></a> <span class="sc">&gt;</span><span class="dv">50</span>K  <span class="fl">0.002156813</span> <span class="fl">0.002664298</span> <span class="fl">0.0005074854</span>     <span class="fl">0.0003806141</span>      <span class="fl">0.9099213</span></span>
<span id="cb8-143"><a href="#cb8-143" aria-hidden="true" tabindex="-1"></a>            Vietnam   Yugoslavia</span>
<span id="cb8-144"><a href="#cb8-144" aria-hidden="true" tabindex="-1"></a> <span class="sc">&lt;=</span><span class="dv">50</span>K <span class="fl">0.0025443237</span> <span class="fl">0.0004442470</span></span>
<span id="cb8-145"><a href="#cb8-145" aria-hidden="true" tabindex="-1"></a> <span class="sc">&gt;</span><span class="dv">50</span>K  <span class="fl">0.0007612281</span> <span class="fl">0.0008880995</span></span>
<span id="cb8-146"><a href="#cb8-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-147"><a href="#cb8-147" aria-hidden="true" tabindex="-1"></a><span class="sc">==</span><span class="er">===============</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="supervisor-provided-r-code-for-naive-bayes-classifier" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="supervisor-provided-r-code-for-naive-bayes-classifier"><span class="header-section-number">7</span> Supervisor-provided R code for Naive Bayes Classifier</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>ptm <span class="ot">&lt;-</span> <span class="fu">proc.time</span>()</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="do">#### read training and tesing</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>D <span class="ot">=</span> <span class="fu">read.table</span>(<span class="st">"adult.data"</span>,<span class="at">sep=</span><span class="st">","</span>,<span class="at">stringsAsFactors =</span> F)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>Dt <span class="ot">=</span> <span class="fu">read.table</span>(<span class="st">"adult.test"</span>,<span class="at">sep=</span><span class="st">","</span>,<span class="at">skip=</span><span class="dv">1</span>,<span class="at">stringsAsFactors =</span> F)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(D)<span class="ot">=</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"workclass"</span>,<span class="st">"fnlwgt"</span>,<span class="st">"education"</span>,<span class="st">"education_num"</span>,<span class="st">"matrital_status"</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>               <span class="st">"occupation"</span>,<span class="st">"relationship"</span>,<span class="st">"race"</span>,<span class="st">"sex"</span>,<span class="st">"capital_gain"</span>,<span class="st">"capital_loss"</span>,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>               <span class="st">"hours_per_week"</span>,<span class="st">"native_country/region"</span>,<span class="st">"salary"</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Dt) <span class="ot">=</span> <span class="fu">colnames</span>(D)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="do">#### extract discrete variables</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>dis.indice <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">14</span>)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>con.indice <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>)</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>is.class.zero <span class="ot">=</span> (D[,<span class="dv">15</span>]<span class="sc">==</span><span class="st">" &lt;=50K"</span>)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>Yt <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>,<span class="fu">nrow</span>(Dt))</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>Yt[Dt[,<span class="dv">15</span>]<span class="sc">==</span><span class="st">" &gt;50K."</span>] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="do">#### training and testing</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>n0 <span class="ot">=</span> <span class="fu">sum</span>(is.class.zero)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>n1 <span class="ot">=</span> <span class="fu">sum</span>(<span class="sc">!</span>is.class.zero)</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>P0 <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>,<span class="at">nrow=</span><span class="fu">nrow</span>(Dt),<span class="at">ncol=</span>(<span class="fu">ncol</span>(Dt)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>P1 <span class="ot">=</span> P0</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="do">##### for discrete variables</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> dis.indice){</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">=</span> <span class="fu">c</span>(D[is.class.zero,i],D[<span class="sc">!</span>is.class.zero,i],Dt[,i])</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">=</span> <span class="fu">as.factor</span>(x)</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>  xnames <span class="ot">=</span> <span class="fu">levels</span>(x)</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>  loc <span class="ot">=</span> <span class="fu">which</span>(xnames<span class="sc">==</span><span class="st">" ?"</span>)</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(loc)<span class="sc">!=</span><span class="dv">0</span>){</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>    xnames <span class="ot">=</span> xnames[<span class="sc">-</span>loc]</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">=</span> <span class="fu">length</span>(xnames)</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>  <span class="do">#### training and testing at the same time</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>d){</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>    P0[Dt[,i]<span class="sc">==</span>xnames[j],i] <span class="ot">=</span> <span class="fu">log</span>((<span class="fu">sum</span>(D[is.class.zero,i]<span class="sc">==</span>xnames[j])<span class="sc">+</span>alpha)<span class="sc">/</span>(n0<span class="sc">+</span>d<span class="sc">*</span>alpha))</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>    P1[Dt[,i]<span class="sc">==</span>xnames[j],i] <span class="ot">=</span> <span class="fu">log</span>((<span class="fu">sum</span>(D[<span class="sc">!</span>is.class.zero,i]<span class="sc">==</span>xnames[j])<span class="sc">+</span>alpha)<span class="sc">/</span>(n1<span class="sc">+</span>d<span class="sc">*</span>alpha))</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a><span class="do">##### for continuous variables</span></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> con.indice){</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>  sigma0 <span class="ot">=</span> <span class="fu">sd</span>(D[is.class.zero,i]); sigma1 <span class="ot">=</span> <span class="fu">sd</span>(D[<span class="sc">!</span>is.class.zero,i])</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>  mu0 <span class="ot">=</span> <span class="fu">mean</span>(D[is.class.zero,i]); mu1 <span class="ot">=</span> <span class="fu">mean</span>(D[<span class="sc">!</span>is.class.zero,i])</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>  P0[,i] <span class="ot">=</span> <span class="sc">-</span><span class="fu">log</span>(sigma0)<span class="sc">-</span>(Dt[,i]<span class="sc">-</span>mu0)<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>sigma0<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="dv">2</span></span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>  P1[,i] <span class="ot">=</span> <span class="sc">-</span><span class="fu">log</span>(sigma1)<span class="sc">-</span>(Dt[,i]<span class="sc">-</span>mu1)<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>sigma1<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="dv">2</span></span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a><span class="do">#### NB result</span></span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>P0 <span class="ot">=</span> <span class="fu">cbind</span>(P0,<span class="fu">rep</span>(<span class="fu">log</span>(n0<span class="sc">/</span>(n0<span class="sc">+</span>n1)),<span class="fu">nrow</span>(P0)))</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>P1 <span class="ot">=</span> <span class="fu">cbind</span>(P1,<span class="fu">rep</span>(<span class="fu">log</span>(n1<span class="sc">/</span>(n0<span class="sc">+</span>n1)),<span class="fu">nrow</span>(P1)))</span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>diff.P <span class="ot">=</span> P0 <span class="sc">-</span> P1</span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(diff.P) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"workclass"</span>,<span class="st">"fnlwgt"</span>,<span class="st">"education"</span>,<span class="st">"education_num"</span>,<span class="st">"matrital_status"</span>,</span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>  <span class="st">"occupation"</span>,<span class="st">"relationship"</span>,<span class="st">"race"</span>,<span class="st">"sex"</span>,<span class="st">"capital_gain"</span>,<span class="st">"capital_loss"</span>,</span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>  <span class="st">"hours_per_week"</span>,<span class="st">"native_country/region"</span>,<span class="st">"prior"</span>)</span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>diff <span class="ot">=</span> <span class="fu">rowSums</span>(diff.P)          </span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a><span class="co">#M0 = rowSums(P0)+log(n0/(n0+n1))</span></span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a><span class="co">#M1 = rowSums(P1)+log(n1/(n0+n1))</span></span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a><span class="co">#diff = M0-M1</span></span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a><span class="do">###### plot ROC</span></span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>Yt.sorted <span class="ot">=</span> Yt[<span class="fu">sort</span>(diff,<span class="at">index.return=</span>T)[[<span class="st">"ix"</span>]]]</span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>sen <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>,<span class="fu">length</span>(Yt.sorted)<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>spe <span class="ot">=</span> <span class="fu">rep</span>(<span class="fu">sum</span>(Yt.sorted<span class="sc">==</span><span class="dv">0</span>),<span class="fu">length</span>(Yt.sorted)<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(Yt.sorted)){</span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (Yt.sorted[j]<span class="sc">==</span><span class="dv">1</span>){</span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>    sen[j<span class="sc">+</span><span class="dv">1</span>]<span class="ot">=</span>sen[j]<span class="sc">+</span><span class="dv">1</span>;spe[j<span class="sc">+</span><span class="dv">1</span>]<span class="ot">=</span>spe[j]</span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>    spe[j<span class="sc">+</span><span class="dv">1</span>]<span class="ot">=</span>spe[j]<span class="sc">-</span><span class="dv">1</span>;sen[j<span class="sc">+</span><span class="dv">1</span>]<span class="ot">=</span>sen[j]</span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a>sen <span class="ot">=</span> sen<span class="sc">/</span><span class="fu">sum</span>(Yt.sorted<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a>spe <span class="ot">=</span> spe<span class="sc">/</span><span class="fu">sum</span>(Yt.sorted<span class="sc">==</span><span class="dv">0</span>)</span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a>auc <span class="ot">=</span> <span class="fu">sum</span>((spe[<span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(spe)<span class="sc">-</span><span class="dv">1</span>)]<span class="sc">-</span>spe[<span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(spe)])<span class="sc">*</span>sen[<span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(sen)<span class="sc">-</span><span class="dv">1</span>)])</span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">-</span>spe,sen,<span class="at">type=</span><span class="st">"l"</span>,<span class="at">col=</span><span class="st">"blue"</span>,<span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">"ROC curve, AUC ="</span>,<span class="fu">round</span>(auc,<span class="dv">3</span>)),<span class="at">ylab =</span> <span class="st">"sensitivity"</span>,<span class="at">xlab =</span> <span class="st">"1-specificity"</span>)</span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="dv">0</span>,<span class="at">b=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Naive-bayes-model_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="do">### confusion matrix</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>Confmat <span class="ot">=</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,<span class="at">nrow =</span> <span class="dv">2</span>,<span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(Confmat) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"&lt;=50K"</span>,<span class="st">"&gt;50K"</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Confmat) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Predict &lt;=50K"</span>,<span class="st">"Predict &gt;50K"</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>Confmat[<span class="st">"&lt;=50K"</span>,<span class="st">"Predict &lt;=50K"</span>] <span class="ot">=</span> <span class="fu">sum</span>(diff<span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;</span> Yt<span class="sc">==</span><span class="dv">0</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>Confmat[<span class="st">"&lt;=50K"</span>,<span class="st">"Predict &gt;50K"</span>] <span class="ot">=</span> <span class="fu">sum</span>(diff<span class="sc">&lt;</span><span class="dv">0</span> <span class="sc">&amp;</span> Yt<span class="sc">==</span><span class="dv">0</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>Confmat[<span class="st">"&gt;50K"</span>,<span class="st">"Predict &lt;=50K"</span>] <span class="ot">=</span> <span class="fu">sum</span>(diff<span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;</span> Yt<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>Confmat[<span class="st">"&gt;50K"</span>,<span class="st">"Predict &gt;50K"</span>] <span class="ot">=</span> <span class="fu">sum</span>(diff<span class="sc">&lt;</span><span class="dv">0</span> <span class="sc">&amp;</span> Yt<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>acc <span class="ot">=</span> <span class="fu">sum</span>(Confmat[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>)])<span class="sc">/</span><span class="fu">sum</span>(Confmat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>Confmat</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>      Predict <span class="sc">&lt;=</span><span class="dv">50</span>K Predict <span class="sc">&gt;</span><span class="dv">50</span>K</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;=</span><span class="dv">50</span>K         <span class="dv">11547</span>          <span class="dv">888</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span><span class="dv">50</span>K           <span class="dv">1863</span>         <span class="dv">1983</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Total accuary ="</span>, acc)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>Total accuary <span class="ot">=</span> <span class="fl">0.83103</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="fu">proc.time</span>() <span class="sc">-</span> ptm</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>   user  system elapsed </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fl">0.285</span>   <span class="fl">0.016</span>   <span class="fl">0.304</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>